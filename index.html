<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>recorder</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style type="text/css">
  button{
    width: 100px;
    border-radius: 50px;
    padding:10px;
    display: inline-block;
    float: none;
    clear: both;
    font-weight: bold;
    font-size: 12px;
  }
  audio{
    display: block;
    margin:10px 0;
  }
  .container{
    margin:0 auto;
    width:350px;
    background: #ddd;
    padding: 10px;
  }
  </style>
</head>
<body>
  <div class="container">
    <fieldset>
      <legend>Record audio</legend> 
      <video  id="player" muted controls width="100%" autoplay playsinline></video>
      <button id="mic" onclick="start()">Start</button>
      <button id="playbtn" onclick="play()">play</button>
      <button onclick="window.location.reload()">reload</button>
    </fieldset>
  </div>
  saving result 
  <small id="blob"></small>
  
  <script type="text/javascript">

    var player = document.getElementById('player');
    var playbtn = document.getElementById('playbtn');
    var blob = document.getElementById('blob');
    recorded_data = '';

    window.addEventListener('load',startUp);
    function startUp(){
      audioStream = function(stream){
        player.srcObject = stream;
      };
      error = function(){
        alert('startup error');
      };
      navigator.getUserMedia = ( navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.mediaDevices.getUserMedia);
      // navigator.getUserMedia({audio:true,video:true}).then(audioStream);
      navigator.getUserMedia({audio:true,video:true},audioStream,error);
    }

    function start(){
      console.log('start()');
      var mic = document.getElementById('mic');
      var att = document.createAttribute('onclick');
      att.value = 'stop()';
      mic.innerHTML = 'Stop';
      mic.style.backgroundColor = 'red';
      mic.style.color = 'white';
      mic.setAttributeNode(att);
      recording();
    }

    function stop(){
      console.log('stop()');
      var mic = document.getElementById('mic');
      var att = document.createAttribute('onclick');
      att.value = 'start()';
      mic.setAttributeNode(att);
      mic.innerHTML = 'Start';
      mic.style.backgroundColor = 'white';
      playbtn.style.backgroundColor = '#30c3ff';
      playbtn.style.color = 'white';
      mic.style.color = 'black';
      recordStop();
    }

    function recording(){
      const audioStream = function(stream){
        alert('streaming');
        chunks = [];
        blob.innerHTML='';   
        const options = {mimeType:'video/webm'};
        try{
          mediaRecorder = new MediaRecorder(stream, options);
          mediaRecorder.start(1);
        }
        catch(e){
          alert('streaming error');
        }
        
        mediaRecorder.ondataavailable = function(event) {
          if (event.data && event.data.size >0) {
            chunks.push(event.data);
            
             console.log(chunks);
             blob.innerHTML += chunks;
          }
        };
        player.volume = 0;
        player.srcObject = stream;
        player.play();
      }
      error = function(e) {
        alert('device error');
      }
      navigator.getUserMedia = ( navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.mediaDevices.getUserMedia);
      // navigator.getUserMedia({audio:true,video:true}).then(audioStream);
      navigator.getUserMedia({audio:true,video:true},audioStream,error);
    }

    function recordStop() {
      mediaRecorder.stop();
      var raw_data = new Blob(chunks,{type:mediaRecorder.mimeType});
      recorded_data = URL.createObjectURL(raw_data);
      player.setAttribute('src','');
      player.src = null;
      player.srcObject = null;
    }

    function play(){
      player.src = recorded_data;
      player.play();
      player.volume = 1;
    }

  </script>
</body>
</html>